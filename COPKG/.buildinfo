/* target information */

#product-info  {
	product-name: "lua";
	version: "5.2.0";
	original-source-location: "http://www.lua.org/ftp/lua-5.2.0.tar.gz";
	original-source-website: "http://www.lua.org/";
	license: "MIT";
	packager: "Hamish C";
}

test {
    uses: release;
    build-command: @"Release\x86\lua -v
        Release\x64\lua -v";
};

package {
    uses: sign;
    build-command: @"autopackage.exe COPKG\lua[vc10]-x86.autopkg
autopackage.exe COPKG\lua-dev-common.autopkg
//autopackage.exe COPKG\lua-dev[vc10]-x86.autopkg
";
    clean-command: @"del COPKG\*.msi COPKG\*.wixpdb";

};

release {
    set: BuildCfg="Release";
    uses: x86;
    uses: x64;
};

sign {
    uses: release;
    build-command: @"simplesigner.exe --nologo --sign Release\x64\**.dll Release\x64\**.exe Release\x86\**.dll Release\x86\**.exe";
};


x86 {
    compiler: vc10;
    platform: x86;

    targets: { 
		"Release\x86\lua5.2.lib",
		"Release\x86\lua5.2.dll",
		"Release\x86\lua.exe",
		"Release\x86\luac.exe",
	};
	
    build-command:@"
		msbuild /p:Platform=win32 /p:Configuration=Release COPKG\lua\lua.sln
	";
    
    clean-command:@"
       if exist Release rmdir /s /q Release > nul 2> nul
       if exist COPKG\lua\Release rmdir /s /q COPKG\lua\Release > nul 2> nul
       if exist COPKG\lua\ipch rmdir /s /q COPKG\lua\ipch > nul 2> nul
       del /S /Q /A - *.sdf *.suo *.user *.exe *.pdb  > nul 2>NUL
    ";
};

x64 {
    compiler: vc10;
    platform: x64;

    targets: { 
		"Release\x64\lua5.2.lib",
		"Release\x64\lua5.2.dll",
		"Release\x64\lua.exe",
		"Release\x64\luac.exe",
	};
	
    build-command:@"
        msbuild /p:Platform=x64 /p:Configuration=Release COPKG\lua\lua.sln
    ";
    clean-command:@"
       if exist Release rmdir /s /q Release > nul 2> nul
       if exist COPKG\lua\Release rmdir /s /q COPKG\lua\Release > nul 2> nul
       if exist COPKG\lua\ipch rmdir /s /q COPKG\lua\ipch > nul 2> nul
       del /S /Q /A - *.sdf *.suo *.user *.exe *.pdb  > nul 2>NUL
    ";
};